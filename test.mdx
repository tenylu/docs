---
title: "登录测试"
description: "测试强制登录功能"
groups: ["public"]
---

# 登录功能测试

<Card>
  <div style={{ padding: '2rem', textAlign: 'center' }}>
    <h2 style={{ color: '#FA254A', marginBottom: '2rem' }}>强制登录测试</h2>
    
    <div style={{ 
      padding: '1.5rem', 
      border: '1px solid #E5E7EB', 
      borderRadius: '8px',
      backgroundColor: '#F9FAFB',
      marginBottom: '2rem'
    }}>
      <h3 style={{ margin: '0 0 1rem 0', color: '#1F2937' }}>测试说明</h3>
      <div style={{ textAlign: 'left', marginBottom: '1rem' }}>
        <p style={{ margin: '0.5rem 0' }}><strong>功能:</strong> 访问任何页面都需要先登录</p>
        <p style={{ margin: '0.5rem 0' }}><strong>API:</strong> https://api.crowmesh.com</p>
        <p style={{ margin: '0.5rem 0' }}><strong>登录方式:</strong> 邮箱 + 密码</p>
        <p style={{ margin: '0.5rem 0' }}><strong>存储:</strong> localStorage (crowmesh_token, crowmesh_user)</p>
      </div>
    </div>
    
    <div style={{ display: 'flex', gap: '1rem', justifyContent: 'center', flexWrap: 'wrap' }}>
      <button 
        onclick="checkLoginStatus()"
        style={{
          padding: '0.75rem 1.5rem',
          backgroundColor: '#10B981',
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
          fontSize: '1rem',
          fontWeight: '500'
        }}
      >
        检查登录状态
      </button>
      <button 
        onclick="logout()"
        style={{
          padding: '0.75rem 1.5rem',
          backgroundColor: '#EF4444',
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
          fontSize: '1rem',
          fontWeight: '500'
        }}
      >
        退出登录
      </button>
      <button 
        onclick="window.location.href='/'"
        style={{
          padding: '0.75rem 1.5rem',
          backgroundColor: '#3B82F6',
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
          fontSize: '1rem',
          fontWeight: '500'
        }}
      >
        返回首页
      </button>
    </div>
  </div>
</Card>

<script>
  // 检查登录状态
  function checkLoginStatus() {
    const token = localStorage.getItem('crowmesh_token');
    const user = localStorage.getItem('crowmesh_user');
    
    if (token && user) {
      const userData = JSON.parse(user);
      showMessage(`已登录: ${userData.name || userData.email}`, 'success');
    } else {
      showMessage('未登录', 'error');
    }
  }
  
  // 登出功能
  function logout() {
    if (confirm('确定要退出登录吗？')) {
      localStorage.removeItem('crowmesh_token');
      localStorage.removeItem('crowmesh_user');
      showMessage('已退出登录，正在跳转...', 'success');
      setTimeout(() => {
        window.location.href = '/login';
      }, 1000);
    }
  }
  
  // 显示消息
  function showMessage(message, type) {
    // 移除现有的消息
    const existingMessage = document.querySelector('.test-message');
    if (existingMessage) {
      existingMessage.remove();
    }
    
    // 创建新消息
    const messageDiv = document.createElement('div');
    messageDiv.className = 'test-message';
    messageDiv.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 6px;
      color: white;
      font-weight: 500;
      z-index: 1000;
      max-width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      ${type === 'success' ? 'background-color: #10B981;' : 'background-color: #EF4444;'}
    `;
    messageDiv.textContent = message;
    
    document.body.appendChild(messageDiv);
    
    // 3秒后自动移除
    setTimeout(() => {
      if (messageDiv.parentNode) {
        messageDiv.remove();
      }
    }, 3000);
  }
  
  // 页面加载时检查登录状态
  document.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('crowmesh_token');
    const user = localStorage.getItem('crowmesh_user');
    
    if (token && user) {
      const userData = JSON.parse(user);
      showMessage(`欢迎回来，${userData.name || userData.email}！`, 'success');
    }
  });
</script>
